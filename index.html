<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Arpit Agrawal — Portfolio</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#F3F2F1;          /* light grey, Office/Fluent */
  --card:#FFFFFF;
  --muted:#605E5C;
  --ink:#201F1E;

  --accent:#2560E0;      /* Microsoft blue */
  --accent-soft:#E1ECFF;

  --border:#E1DFDD;
  --border-strong:#C8C6C4;
  --glass:#E1DFDD;

  --radius:6px;
  --maxw:1120px;
  --soft-shadow:0 2px 6px rgba(0,0,0,0.05);
}

*{
  box-sizing:border-box;
  transition:
    background-color .14s ease,
    border-color .14s ease,
    box-shadow .14s ease,
    color .14s ease,
    transform .08s ease;
}

html,body{height:100%}

body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family: system-ui, -apple-system, "Segoe UI", Inter, Roboto;
  font-size:14px;
  -webkit-font-smoothing:antialiased;
}

a{color:inherit;text-decoration:none}

/* ========== HEADER ========== */

.container{
  max-width:var(--maxw);
  margin:30px auto;
  padding:0 22px 24px;
}

.topbar{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:20px;
  padding:0 0 12px;
  border-bottom:1px solid var(--border);
}

.brand{
  display:flex;
  gap:14px;
  align-items:flex-start;
}

.avatar{
  width:60px;
  height:60px;
  border-radius:12px;
  overflow:hidden;
  background:#D0D0D0;
}

.avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

.name-row{
  display:flex;
  align-items:center;
  gap:8px;
}

.name-row h1{
  margin:0;
  font-size:20px;
  font-weight:600;
}

.role-pill{
  padding:2px 8px;
  border-radius:999px;
  background:var(--accent-soft);
  color:var(--accent);
  font-size:11px;
  font-weight:600;
}

.subtitle{
  margin:2px 0 0 0;
  font-size:13px;
  color:var(--muted);
}

.subtitle-small{
  margin:4px 0 0 0;
  font-size:12px;
  color:var(--muted);
}

.ms-logo{
  height:16px;
}

.top-actions{
  display:flex;
  gap:10px;
  align-items:center;
}

/* ========== BUTTONS ========== */

.btn{
  padding:7px 12px;
  border-radius:4px;
  border:1px solid var(--border-strong);
  background:#FFFFFF;
  font-size:13px;
  font-weight:500;
  color:var(--ink);
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  gap:6px;
}

.btn:hover{
  background:#F3F2F1;
  border-color:var(--border-strong);
  box-shadow:0 1px 2px rgba(0,0,0,0.12);
}

.btn.primary{
  background:var(--accent);
  border-color:var(--accent);
  color:#FFFFFF;
  box-shadow:0 1px 3px rgba(0,0,0,0.18);
}

.btn.primary:hover{
  background:#1E4EB7;
}

.btn.ghost{
  background:transparent;
}

/* ========== LAYOUT & PANELS ========== */

.layout{
  display:grid;
  grid-template-columns:320px 1fr;
  gap:18px;
  margin-top:18px;
}

@media (max-width:980px){
  .layout{
    grid-template-columns:1fr;
  }
}

.panel{
  background:var(--card);
  border-radius:var(--radius);
  border:1px solid var(--border);
  padding:14px 16px;
  box-shadow:0 1px 3px rgba(0,0,0,0.04);
}

.panel h3{
  margin:0 0 6px 0;
  font-size:14px;
  font-weight:600;
}

/* ========== SKILLS & EXPERIENCE LEFT ========== */

.molecule-wrap{
  position:relative;
  height:520px;
  border-radius:var(--radius);
  overflow:hidden;
  border:1px solid var(--border);
  background:#FFFFFF;
}

canvas#moleculeCanvas{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  display:block;
  z-index:0;
}

#moleculeNodes{
  position:absolute;
  inset:0;
  z-index:2;
  pointer-events:auto;
}

.node-pill{
  position:absolute;
  padding:8px 12px;
  border-radius:999px;
  background:rgba(255,255,255,0.98);
  border:1px solid var(--border);
  font-weight:700;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
}

.node-pill .lvl{
  font-size:11px;
  color:var(--muted);
  font-weight:600;
}

.node-pill:hover{
  transform:translateY(-3px);
  box-shadow:0 8px 20px rgba(0,0,0,0.06);
}

.skills-tip{
  position:absolute;
  left:12px;
  right:12px;
  bottom:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  z-index:3;
}

/* Experience card */

.experience-card{
  margin-top:16px;
  padding:10px 12px;
  border-radius:var(--radius);
  border:1px solid var(--border);
  background:#FAFAFA;
}

.experience-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  margin-bottom:4px;
}

.experience-title{
  font-size:13px;
  font-weight:600;
}

.experience-badge{
  padding:2px 8px;
  border-radius:999px;
  background:#E6F0FF;
  color:#20488F;
  font-size:11px;
  font-weight:600;
}

.experience-meta{
  font-size:12px;
  color:var(--muted);
  margin:2px 0 6px 0;
}

.experience-list{
  margin:0;
  padding-left:18px;
  font-size:12px;
  color:var(--muted);
}

/* ========== RIGHT COLUMN: FEATURED & PROJECTS ========== */

.hero-panel{
  margin-top:12px;
}

.hero-banner{
  background:#FFFFFF;
  border-radius:var(--radius);
  border:1px solid var(--border);
  padding:12px 14px;
  display:grid;
  grid-template-columns:minmax(280px,2fr) 1.2fr;
  gap:12px;
}

.hero-video{
  border-radius:4px;
  overflow:hidden;
  border:1px solid var(--border);
  box-shadow:0 1px 3px rgba(0,0,0,0.06);
}

.hero-video video{
  width:100%;
  height:auto;
  display:block;
  border-radius:4px;
}

.hero-copy h4{
  margin:0 0 6px 0;
  font-size:14px;
  font-weight:600;
}

.hero-tech{
  margin-top:8px;
  font-size:12px;
  color:var(--muted);
}

@media (max-width:900px){
  .hero-banner{
    grid-template-columns:1fr;
  }
}

/* Filters & project cards */

.filters{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:8px;
}

.chip{
  padding:4px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#FAFAFA;
  font-weight:500;
  font-size:12px;
  color:var(--muted);
  cursor:pointer;
}

.chip.active{
  background:var(--accent-soft);
  color:var(--ink);
  border-color:var(--accent);
}

.grid-projects{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
  gap:10px;
  margin-top:10px;
}

.proj-card{
  background:#FFFFFF;
  border-radius:var(--radius);
  border:1px solid var(--border);
  padding:10px 12px;
  display:grid;
  grid-template-columns:110px 1fr;
  gap:10px;
  align-items:center;
  box-shadow:0 1px 3px rgba(0,0,0,0.04);
  cursor:pointer;
}

.proj-thumb{
  height:72px;
  border-radius:4px;
  overflow:hidden;
  background:#F3F2F1;
}

.proj-thumb img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.proj-info h4{
  margin:0 0 4px 0;
  font-size:13px;
  font-weight:600;
}

.proj-meta{
  margin:0;
  font-size:12px;
  color:var(--muted);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.proj-tags{
  margin-top:6px;
  display:flex;
  flex-wrap:wrap;
  gap:4px;
}

.tag{
  padding:2px 7px;
  border-radius:999px;
  border:1px solid var(--border);
  font-size:11px;
  color:var(--muted);
}

/* ========== CONTACT ========== */

.contact-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:14px;
}

.input,
textarea{
  padding:8px 10px;
  border-radius:4px;
  border:1px solid var(--border);
  font-size:13px;
  background:#FFFFFF;
}

textarea{
  min-height:110px;
  resize:vertical;
}

.input:focus,
textarea:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 1px var(--accent-soft);
}

.contact-actions{
  display:flex;
  gap:8px;
  justify-content:flex-end;
  margin-top:10px;
}

/* ========== MODAL & FOOTER ========== */

.backdrop{
  position:fixed;
  inset:0;
  background:rgba(12,15,20,0.5);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.modal{
  width:min(880px,94%);
  background:var(--card);
  padding:18px;
  border-radius:8px;
  border:1px solid var(--border);
  max-height:90vh;
  overflow:auto;
  box-shadow:0 12px 35px rgba(0,0,0,0.25);
}

.modal .media-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:12px;
}

.modal img,
.modal video{
  width:100%;
  border-radius:6px;
}

footer{
  margin-top:26px;
  color:var(--muted);
  font-size:13px;
  text-align:center;
}

/* ========== RESPONSIVE TWEAKS ========== */

@media (max-width:720px){
  .grid-projects{grid-template-columns:1fr}
  .contact-grid{grid-template-columns:1fr}
  .molecule-wrap{height:520px}
}
</style>
</head>
<body>
  <div class="container">
    <header class="topbar">
      <div class="brand">
        <div class="avatar">
          <img src="me-image.jpg" alt="Arpit Agrawal">
        </div>
        <div>
          <div class="name-row">
            <h1>Arpit Agrawal</h1>
            <span class="role-pill">Data Analyst · Microsoft</span>
          </div>
          <p class="subtitle">
            Data Analyst · Data Engineer · Visual Storyteller
          </p>
          <p class="subtitle-small">
            Currently: Analytics (Vendor) at Microsoft · Building data products with SQL, Python &amp; Power BI.
          </p>
        </div>
      </div>

      <nav class="top-actions">
        <a id="resumeLink" href="Me-Resume.pdf" class="btn" target="_blank" rel="noopener">Resume</a>
        <label class="btn ghost">
          <input id="resumeUploader" type="file" accept=".pdf,.doc,.docx" hidden />
          Upload
        </label>
        <button class="btn primary" id="contactBtn">Contact</button>
      </nav>
    </header>

    <div class="layout">
      <!-- LEFT: Molecules + Experience -->
      <aside class="panel" aria-labelledby="skillsTitle">
        <h3 id="skillsTitle">Skills Molecules</h3>
        <p style="margin:0 0 10px 0;color:var(--muted)">Interactive skill map grouped by clusters — click a node to filter projects. Drag to pan.</p>

        <div class="molecule-wrap">
          <canvas id="moleculeCanvas" aria-hidden="true"></canvas>
          <div id="moleculeNodes" aria-hidden="false"></div>

          <div class="skills-tip">
            <div style="color:var(--muted);font-size:13px">Tip: click a node to filter projects. Drag to pan.</div>
            <div style="display:flex;gap:8px">
              <button class="btn" id="shuffleNodes">Shuffle</button>
              <button class="btn" id="resetNodes">Reset</button>
            </div>
          </div>
        </div>

        <div style="margin-top:12px">
          <strong>Selected Skill</strong>
          <div id="skillDetails" style="margin-top:8px;color:var(--muted);font-size:13px">Click a node to see details.</div>
        </div>

        <!-- Experience card -->
        <section class="experience-card" aria-label="Experience at Microsoft">
          <div class="experience-header">
            <div>
              <div class="experience-title">Microsoft · Data Analyst</div>
              <div class="experience-meta">Vendor – BlitzPath Innovation · 2025 — Present</div>
            </div>
            <span class="experience-badge">Microsoft</span>
          </div>
          <ul class="experience-list">
            <li>Building dashboards for operations & leadership teams.</li>
            <li>Automating reporting in Power BI &amp; SQL to reduce manual work.</li>
            <li>Owning KPIs around performance, reliability, and customer impact.</li>
          </ul>
        </section>
      </aside>

      <!-- RIGHT: Projects + Contact -->
      <main>
        <!-- Featured Video Card -->
        <section class="panel hero-panel">
          <h3>Featured Walkthrough</h3>
          <p style="margin:0 0 10px 0;color:var(--muted)">
            Short demo of the Retail &amp; Logistics Intelligence Hub.
          </p>

          <div class="hero-banner">
            <div class="hero-video">
              <video id="featuredVideo" controls playsinline>
                <source src="canva-R7YS5xjlsvA.mp4" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            </div>

            <div class="hero-copy">
              <h4>Retail &amp; Logistics — walkthrough</h4>
              <p style="margin:0;color:var(--muted);font-size:13px">
                End-to-end analytics hub for routing optimisation, forecasting, and ops insights.
              </p>
              <p class="hero-tech">
                Built using: SQL · Power BI · Azure · Python<br>
                Inspired by internal Microsoft reporting patterns (demo only).
              </p>
              <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn"
                  onclick="openCaseStudy(PROJECTS.find(p=>p.id==='retail'))">
                  Open case study
                </button>
                <button class="btn"
                  onclick="document.getElementById('featuredVideo').play()">
                  Play
                </button>
              </div>
            </div>
          </div>
        </section>

        <section class="panel" style="margin-top:14px">
          <h3>Project Gallery</h3>
          <div class="filters" id="filters"></div>
          <div class="grid-projects" id="gallery"></div>
        </section>

        <section class="panel contact-panel" style="margin-top:14px">
          <h3>Contact</h3>
          <p style="margin:6px 0 12px 0;color:var(--muted)">Shoot a short note — demo submit only (replace with webhook in JS).</p>
          <form id="contactForm" onsubmit="return false;">
            <div class="contact-grid">
              <input class="input" id="c_name" placeholder="Your name" />
              <input class="input" id="c_email" placeholder="Email" />
              <input class="input" id="c_role" placeholder="Role / short note" style="grid-column:1/3" />
              <textarea id="c_msg" placeholder="Message — be brief, be human" style="grid-column:1/3"></textarea>
            </div>
            <div class="contact-actions">
              <button class="btn" id="clearBtn" type="button">Clear</button>
              <button class="btn primary" id="sendBtn">Send</button>
            </div>
            <div id="contactResult" style="margin-top:10px;color:var(--muted)"></div>
          </form>
        </section>
      </main>
    </div>

    <footer>Built with care — interactive portfolio.</footer>
  </div>

  <!-- Modal -->
  <div class="backdrop" id="backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="modalTitle">Case study</h3>
        <button class="btn" id="closeModal">Close</button>
      </div>
      <p id="modalBlurb" style="color:var(--muted)"></p>
      <div id="modalBody" class="modal-body"></div>
    </div>
  </div>

<script>
/* ===== DATA: skills & projects ===== */
const SKILLS = [
  {id:'sql',label:'SQL',lvl:'Expert',desc:'Relational queries, window functions, MySQL Workbench'},
  {id:'python',label:'Python',lvl:'Expert',desc:'Pandas, NumPy, scripting, ETL'},
  {id:'pandas',label:'Pandas',lvl:'Expert',desc:'Dataframes, joins, cleaning'},
  {id:'powerbi',label:'Power BI',lvl:'Advanced',desc:'Dashboards & measures'},
  {id:'tableau',label:'Tableau',lvl:'Advanced',desc:'Viz & dashboards'},
  {id:'excel',label:'Advanced Excel',lvl:'Advanced',desc:'Pivot tables and modeling'},
  {id:'pivot',label:'Pivot Tables',lvl:'Advanced',desc:'Slicing & analysis'},
  {id:'dataclean',label:'Data Cleaning',lvl:'Expert',desc:'Missing values, normalization'},
  {id:'dataviz',label:'Data Visualization',lvl:'Advanced',desc:'Story-driven visuals'},
  {id:'spss',label:'SPSS',lvl:'Advanced',desc:'Stat tests & regressions'},
  {id:'brd',label:'BRD/FRD/SRS',lvl:'Intermediate',desc:'Requirements docs'},
  {id:'datainterp',label:'Data Interpretation',lvl:'Advanced',desc:'Insights & recommendations'},
  {id:'azure',label:'Azure',lvl:'Intermediate',desc:'Cloud & Databricks'},
  {id:'git',label:'Git / GitHub',lvl:'Intermediate',desc:'Version control'}
];

const PROJECTS = [
  {
    id:'promo',
    title:'Smart Promotion Profitability Tracker',
    tags:['ETL','SQL','Power BI'],
    blurb:'Promo uplift modelling & profitability command center',
    long:'Built ETL pipelines in Python, A/B tests and uplift modeling, and created a Power BI command center to track promotion ROI.',
    thumb:'SmartPromotionProfitabilityTracker.jpg',
    media:[ {type:'img', src:'SmartPromotionProfitabilityTracker.jpg', caption:'Command center snapshot'} ]
  },
  {
    id:'retail',
    title:'Retail & Logistics Intelligence Hub',
    tags:['Geo','SQL','Tableau'],
    blurb:'Route optimisation & forecasting, Snowflake analytics',
    long:'End-to-end analytics for logistics—forecasting, route optimisation and cloud analytics in Snowflake and Tableau.',
    thumb:'Retail&LogisticsIntelligenceHub.jpg',
    media:[ {type:'img', src:'Retail&LogisticsIntelligenceHub.jpg', caption:'Logistics dashboard'}, {type:'video', src:'canva-R7Y5xsjlsvA.mp4', caption:'Walkthrough (mp4)'} ]
  },
  {
    id:'supply',
    title:'Supply Chain Disruption Prediction',
    tags:['Spark','Azure','Anomaly','SQL'],
    blurb:'Realtime anomaly detection across 8M+ events',
    long:'Spark streaming + TensorFlow for anomaly detection, alerting layer, and Power BI dashboards for ops.',
    thumb:'SupplyChainDisruptionPrediction.jpg',
    media:[ {type:'img', src:'SupplyChainDisruptionPrediction.jpg', caption:'Anomaly overview'} ]
  },
  {
    id:'print',
    title:'Print Production Analytics',
    tags:['Power BI','Ops','Python'],
    blurb:'Telemetry ingestion & defect analytics',
    long:'Telemetry ingestion, defect classification and interactive dashboards that helped reduce defects in production.',
    thumb:'PrintProductionAnalytics.jpg',
    media:[ {type:'img', src:'PrintProductionAnalytics.jpg', caption:'Production KPIs'} ]
  }
];

/* ===== DOM refs ===== */
const galleryEl = document.getElementById('gallery');
const filtersEl = document.getElementById('filters');
const backdrop = document.getElementById('backdrop');
const modalTitle = document.getElementById('modalTitle');
const modalBlurb = document.getElementById('modalBlurb');
const modalBody = document.getElementById('modalBody');
const skillDetailsEl = document.getElementById('skillDetails');
const resumeLink = document.getElementById('resumeLink');

/* ===== gallery & filters ===== */
function setupFilters(){
  const tags = Array.from(new Set(PROJECTS.flatMap(p=>p.tags)));
  filtersEl.innerHTML = '';
  const all = document.createElement('button');
  all.className='chip active';
  all.textContent='All';
  all.addEventListener('click', ()=>{
    document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
    all.classList.add('active');
    renderGallery(PROJECTS);
  });
  filtersEl.appendChild(all);
  tags.forEach(t=>{
    const b = document.createElement('button');
    b.className='chip';
    b.textContent = t;
    b.addEventListener('click', ()=>{
      document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
      b.classList.add('active');
      renderGallery(PROJECTS.filter(p=>p.tags.includes(t)));
    });
    filtersEl.appendChild(b);
  });
}

function renderGallery(list){
  galleryEl.innerHTML = '';
  list.forEach(p=>{
    const card = document.createElement('article');
    card.className = 'proj-card';
    card.tabIndex = 0;
    const thumbHtml = p.thumb
      ? `<div class="proj-thumb"><img src="${p.thumb}" alt="${p.title}"></div>`
      : `<div class="proj-thumb">${p.tags.join(' • ')}</div>`;
    card.innerHTML =
      thumbHtml +
      `<div class="proj-info">
         <h4>${p.title}</h4>
         <div class="proj-meta">
           <div style="max-width:68%">${p.blurb}</div>
           <div style="color:var(--muted);font-weight:700">${p.tags[0]||''}</div>
         </div>
         <div class="proj-tags">
           ${p.tags.map(t=>`<span class="tag">${t}</span>`).join('')}
         </div>
       </div>`;
    card.addEventListener('click', ()=> openCaseStudy(p));
    card.addEventListener('keydown',(e)=>{ if(e.key==='Enter') openCaseStudy(p); });
    galleryEl.appendChild(card);
  });
}

/* ===== modal ===== */
function openCaseStudy(p){
  modalTitle.textContent = p.title;
  modalBlurb.textContent = p.blurb;
  modalBody.innerHTML = `<p style="color:var(--muted)">${p.long}</p>`;
  if(Array.isArray(p.media) && p.media.length){
    const grid = document.createElement('div');
    grid.className = 'media-grid';
    p.media.forEach(m=>{
      const box = document.createElement('div');
      if(m.type === 'img'){
        box.innerHTML =
          `<img src="${m.src}" alt="${m.caption||p.title}">
           <div style="color:var(--muted);font-size:13px;margin-top:6px">${m.caption||''}</div>`;
      } else if(m.type === 'video'){
        box.innerHTML =
          `<video controls>
             <source src="${m.src}" type="video/mp4">
             Your browser doesn't support video.
           </video>
           <div style="color:var(--muted);font-size:13px;margin-top:6px">${m.caption||''}</div>`;
      }
      grid.appendChild(box);
    });
    modalBody.appendChild(grid);
  }
  backdrop.style.display = 'flex';
  backdrop.setAttribute('aria-hidden','false');
  document.body.style.overflow = 'hidden';
}

document.getElementById('closeModal').addEventListener('click', closeModal);
backdrop.addEventListener('click',(e)=>{ if(e.target === backdrop) closeModal(); });

function closeModal(){
  backdrop.style.display='none';
  backdrop.setAttribute('aria-hidden','true');
  document.body.style.overflow = 'auto';
}

/* ===== contact (demo) ===== */
document.getElementById('sendBtn').addEventListener('click', ()=>{
  const n = document.getElementById('c_name').value.trim();
  const e = document.getElementById('c_email').value.trim();
  const m = document.getElementById('c_msg').value.trim();
  if(!n||!e||!m){
    document.getElementById('contactResult').textContent =
      'Please fill name, email & message.';
    return;
  }
  document.getElementById('contactResult').textContent =
    `Thanks ${n.split(' ')[0]} — message queued (demo).`;
  document.getElementById('contactForm').reset();
});

document.getElementById('clearBtn').addEventListener('click', ()=>{
  document.getElementById('contactForm').reset();
  document.getElementById('contactResult').textContent = '';
});

/* ===== resume uploader (client-only preview) ===== */
document.getElementById('resumeUploader').addEventListener('change',(e)=>{
  const f = e.target.files[0]; if(!f) return;
  const url = URL.createObjectURL(f);
  resumeLink.href = url;
  alert('Local resume link updated in browser (client-only). Commit to repo if you want it persistent.');
});

/* ===== Molecule engine (canvas + DOM pills) ===== */
const mcanvas = document.getElementById('moleculeCanvas');
const mnodes = document.getElementById('moleculeNodes');
const ctx = mcanvas.getContext('2d');
let W = 0, H = 0, DPR = window.devicePixelRatio || 1;
let atoms = [];

function resizeM(){
  DPR = window.devicePixelRatio || 1;
  W = mcanvas.clientWidth;
  H = mcanvas.clientHeight;
  mcanvas.width = Math.max(1, Math.floor(W * DPR));
  mcanvas.height = Math.max(1, Math.floor(H * DPR));
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener('resize', ()=>{ resizeM(); placeAtoms(); });

function placeAtoms(){
  mnodes.innerHTML = '';
  atoms = [];
  const center = {x: W/2, y: H/2};
  const angleStep = (Math.PI * 2) / SKILLS.length;
  SKILLS.forEach((s,i)=>{
    const angle = i * angleStep + (Math.random()*0.6 - 0.3);
    const radius = 110 + Math.random()*160;
    const x = center.x + Math.cos(angle) * radius;
    const y = center.y + Math.sin(angle) * radius;
    const r = 12 + Math.random()*18;
    // calmer motion
    const atom = {
      x,
      y,
      vx:(Math.random()-0.5)*0.25,
      vy:(Math.random()-0.5)*0.25,
      r,
      label: s.label,
      id: s.id,
      desc: s.desc || ''
    };

    const pill = document.createElement('button');
    pill.className = 'node-pill';
    pill.style.left = (x - 60) + 'px';
    pill.style.top = (y - 18) + 'px';
    pill.style.position = 'absolute';
    pill.style.minWidth = '110px';
    pill.innerHTML =
      `<div style="font-weight:700">${s.label}</div>
       <span class="lvl">${s.lvl||''}</span>`;
    pill.dataset.skill = s.id;
    pill.setAttribute('aria-label', `${s.label} — ${s.lvl||''}`);
    pill.addEventListener('click', ()=>{ selectSkill(s.id); });
    pill.addEventListener('keydown',(e)=>{ if(e.key==='Enter') selectSkill(s.id); });
    mnodes.appendChild(pill);
    atom.el = pill;
    atoms.push(atom);
  });

  // decorative floaters
  for(let k=0;k<18;k++){
    atoms.push({
      x: Math.random()*W,
      y: Math.random()*H,
      vx:(Math.random()-0.5)*0.15,
      vy:(Math.random()-0.5)*0.15,
      r:2+Math.random()*6,
      label:null
    });
  }
}

function drawAtoms(){
  ctx.clearRect(0,0,W,H);

  for(let i=0;i<atoms.length;i++){
    const a = atoms[i];
    a.x += a.vx;
    a.y += a.vy;

    if(a.x < 6 || a.x > W-6) a.vx *= -1;
    if(a.y < 6 || a.y > H-6) a.vy *= -1;

    ctx.beginPath();
    if(a.label){
      ctx.fillStyle = 'rgba(255,255,255,0.98)';
      ctx.strokeStyle = 'rgba(0,0,0,0.04)';
      ctx.lineWidth = 1;
      ctx.arc(a.x,a.y,a.r,0,Math.PI*2);
      ctx.fill();
      ctx.stroke();
    } else {
      ctx.fillStyle = 'rgba(0,0,0,0.04)';
      ctx.arc(a.x,a.y,a.r,0,Math.PI*2);
      ctx.fill();
    }

    if(a.el){
      a.el.style.left = (a.x - 60) + 'px';
      a.el.style.top = (a.y - 18) + 'px';
    }
  }

  // links between labeled atoms – softer, Microsoft blue
  for(let i=0;i<atoms.length;i++){
    for(let j=i+1;j<atoms.length;j++){
      const A = atoms[i], B = atoms[j];
      if(!A.label || !B.label) continue;
      const dx = A.x - B.x, dy = A.y - B.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if(dist < 200){
        const alpha = 1 - (dist / 200);
        ctx.beginPath();
        ctx.strokeStyle = `rgba(37,96,224,${0.04 * alpha})`;
        ctx.lineWidth = 1 * alpha;
        ctx.moveTo(A.x, A.y);
        ctx.lineTo(B.x, B.y);
        ctx.stroke();
      }
    }
  }

  requestAnimationFrame(drawAtoms);
}

document.getElementById('shuffleNodes').addEventListener('click', ()=>{
  atoms.forEach(a=>{
    a.vx += (Math.random()-0.5)*0.8;
    a.vy += (Math.random()-0.5)*0.8;
  });
});

document.getElementById('resetNodes').addEventListener('click', ()=>{
  placeAtoms();
  renderGallery(PROJECTS);
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  document.querySelector('.chip')?.classList.add('active');
});

function selectSkill(id){
  const s = SKILLS.find(x=>x.id===id);
  skillDetailsEl.textContent = `${s.label} — ${s.desc || ''}`;
  const filtered = PROJECTS.filter(p=>{
    const hay = (p.title + ' ' + p.tags.join(' ') + ' ' + p.long).toLowerCase();
    return hay.includes(s.label.toLowerCase()) ||
      (p.tags||[]).some(t=>t.toLowerCase().includes(s.label.toLowerCase()));
  });
  renderGallery(filtered.length ? filtered : PROJECTS);
  document.querySelectorAll('.node-pill').forEach(p=>{
    p.style.opacity = (p.dataset.skill === id ? '1' : '0.35');
  });
}

/* pan by dragging */
let dragging=false,startX=0,startY=0;
const moleculeContainer = document.querySelector('.molecule-wrap');
moleculeContainer?.addEventListener('pointerdown', (e)=>{
  dragging=true;
  startX=e.clientX;
  startY=e.clientY;
  moleculeContainer.setPointerCapture(e.pointerId);
});
moleculeContainer?.addEventListener('pointermove', (e)=>{
  if(!dragging) return;
  const dx=e.clientX-startX, dy=e.clientY-startY;
  startX=e.clientX; startY=e.clientY;
  atoms.forEach(a=>{
    a.x += dx*0.12;
    a.y += dy*0.12;
  });
});
moleculeContainer?.addEventListener('pointerup', ()=>{
  dragging=false;
});

/* ===== init ===== */
function init(){
  resizeM();
  placeAtoms();
  drawAtoms();
  setupFilters();
  renderGallery(PROJECTS);
}
window.addEventListener('load', init);
</script>
</body>
</html>
